!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("echarts/core"),require("leaflet")):"function"==typeof define&&define.amd?define(["echarts/core","leaflet"],t):"object"==typeof exports?exports.echartsExtensionLeaflet=t(require("echarts/core"),require("leaflet")):e.echartsExtensionLeaflet=t(e.echarts,e.L)}(self,((e,t)=>(()=>{"use strict";var n={792:t=>{t.exports=e},303:e=>{e.exports=t}},o={};function r(e){var t=o[e];if(void 0!==t)return t.exports;var i=o[e]={exports:{}};return n[e](i,i.exports,r),i.exports}r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};return(()=>{r.r(i);var e=r(792);const t=e.version.split(".");let n={};var o=r(303);function a(t,n){return n=n||[0,0],e.util.map([0,1],(function(e){const o=n[e],r=t[e]/2,i=[],a=[];return i[e]=o-r,a[e]=o+r,i[1-e]=a[1-e]=n[1-e],Math.abs(this.dataToPoint(i)[e]-this.dataToPoint(a)[e])}),this)}const s=["echartsLayerInteractive","renderOnMoving","largeMode","layers"],l=o.Layer.extend({initialize:function(e){this._container=e},onAdd:function(e){e.getPane(this.options.pane).appendChild(this._container)},onRemove:function(e){o.DomUtil.remove(this._container)},_update:function(){}});function c(e,t){this._lmap=e,this._api=t,this._mapOffset=[0,0],this._projection=o.Projection.Mercator}const d=c.prototype;d.setZoom=function(e){this._zoom=e},d.setCenter=function(e){const t=this._projection.project(new o.LatLng(e[1],e[0]));this._center=[t.lng,t.lat]},d.setMapOffset=function(e){this._mapOffset=e},d.setLeaflet=function(e){this._lmap=e},d.getLeaflet=function(){return this._lmap},d.dataToPoint=function(e){const t=new o.LatLng(e[1],e[0]),n=this._lmap.latLngToLayerPoint(t),r=this._mapOffset;return[n.x-r[0],n.y-r[1]]},d.pointToData=function(e){const t=this._mapOffset,n=this._lmap.layerPointToLatLng({x:e[0]+t[0],y:e[1]+t[1]});return[n.lng,n.lat]},d.getViewRect=function(){const t=this._api;return new e.graphic.BoundingRect(0,0,t.getWidth(),t.getHeight())},d.getRoamTransform=function(){return e.matrix.create()},d.prepareCustoms=function(){const t=this.getViewRect();return{coordSys:{type:"lmap",x:t.x,y:t.y,width:t.width,height:t.height},api:{coord:e.util.bind(this.dataToPoint,this),size:e.util.bind(a,this)}}},d.convertToPixel=function(e,t,n){return this.dataToPoint(n)},d.convertFromPixel=function(e,t,n){return this.pointToData(n)},c.create=function(t,n){let r;return t.eachComponent("lmap",(function(t){if("undefined"==typeof L)throw new Error("Leaflet api is not loaded");if(r)throw new Error("Only one lmap echarts component is allowed");let i=t.getLeaflet();const a=t.get("echartsLayerInteractive");if(!i){const r=n.getDom();let a=n.getZr().painter.getViewportRoot();a.className="lmap-ec-layer";let c=r.querySelector(".ec-extension-leaflet");c&&(a.style.left="0px",a.style.top="0px",r.removeChild(c)),c=document.createElement("div"),c.className="ec-extension-leaflet",c.style.cssText="position:absolute;top:0;left:0;bottom:0;right:0;",r.appendChild(c);const d=e.util.clone(t.get());e.util.each(s,(function(e){delete d[e]})),i=new o.Map(c,d);let f=document.createElement("div");f.style="position: relative;",f.appendChild(a),new l(f).addTo(i),t.setLeaflet(i),t.setEChartsLayer(a)}t.__echartsLayerInteractive!==a&&(t.setEChartsLayerInteractive(a),t.__echartsLayerInteractive=a);const d=t.get("center"),f=t.get("zoom");if(d&&f){const e=i.getCenter(),n=i.getZoom();t.centerOrZoomChanged([e.lng,e.lat],n)&&i.setView(new o.LatLng(d[1],d[0]),f)}r=new c(i,n),r.setMapOffset(t.__mapOffset||[0,0]),r.setZoom(f),r.setCenter(d),t.coordinateSystem=r})),t.eachSeries((function(e){"lmap"===e.get("coordinateSystem")&&(e.coordinateSystem=r)})),r&&[r]},d.dimensions=c.dimensions=["lng","lat"],d.type="lmap";const f=c,h={type:"lmap",setLeaflet(e){this.__lmap=e},getLeaflet(){return this.__lmap},getId(){return this.__lmap._leaflet_id},setEChartsLayer(e){this.__echartsLayer=e},getEChartsLayer(){return this.__echartsLayer},setEChartsLayerVisibility(e){this.__echartsLayer.style.display=e?"block":"none"},setEChartsLayerInteractive(e){this.option.echartsLayerInteractive=!!e,this.__echartsLayer.style.pointerEvents=e?"auto":"none"},setCenterAndZoom(e,t){this.option.center=[e[1],e[0]],this.option.zoom=t},centerOrZoomChanged(e,t){const n=this.option;return o=e,r=n.center,!(o&&r&&o[0]===r[0]&&o[1]===r[1]&&t===n.zoom);var o,r},defaultOption:{center:[10.39506,63.43049],zoom:6,echartsLayerInteractive:!0,renderOnMoving:!0,largeMode:!1}},m=e.ComponentModel.extend(h),p={type:"lmap",init(){this._isFirstRender=!0},render(t,n,o){let r=!0;const i=t.getLeaflet(),a=o.getZr().painter.getViewportRoot().parentNode,s=t.coordinateSystem,l=i._mapPane,c=t.get("renderOnMoving"),d=t.get("resizeEnable"),f=t.get("largeMode");let h=function(e){if(r)return;let n=l.style.transform,i=0,c=0;if(n){n=n.replace("translate3d(","");let e=n.split(",");i=-parseInt(e[0],10),c=-parseInt(e[1],10)}else i=-parseInt(l.style.left,10),c=-parseInt(l.style.top,10);const d=[i,c],f=d[0]+"px",h=d[1]+"px";a.style.left!==f&&(a.style.left=f),a.style.top!==h&&(a.style.top=h),s.setMapOffset(t.__mapOffset=d),o.dispatchAction({type:"lmapRoam",animation:{duration:0}})};if(f&&(h=(0,e.throttle)(h,20,!0)),this._isFirstRender&&(this._moveHandler=h),this._ctrlStartHandler=function(e){"ControlLeft"===e.originalEvent.code&&i.dragging.disable()},this._ctrlEndHandler=function(e){"ControlLeft"===e.originalEvent.code&&i.dragging.enable()},i.off("move",this._moveHandler),i.off("moveend",this._moveHandler),i.off("zoom",this._moveHandler),i.off("viewreset",this._moveHandler),i.off("zoomend",this._moveHandler),i.off("keydown",this._ctrlStartHandler),i.off("keyup",this._ctrlEndHandler),this._ctrlStartHandler&&i.off("keydown",this._ctrlStartHandler),this._ctrlEndHandler&&i.off("keyup",this._ctrlEndHandler),this._resizeHandler&&i.off("resize",this._resizeHandler),this._moveStartHandler&&(i.off("move",this._moveStartHandler),i.off("zoomstart",this._moveStartHandler),i.off("zoom",this._moveStartHandler)),i.on(c?"move":"moveend",h),i.on(c?"zoom":"zoomend",h),c&&i.on("viewreset",h),!c&&!this._moveEndHandler){const e=function(e){setTimeout((function(){t.setEChartsLayerVisibility(!0)}),f?20:0)};this._moveEndHandler=e,i.on("moveend",e),i.on("zoomend",e)}if(this._ctrlStartHandler&&i.on("keydown",this._ctrlStartHandler),this._ctrlEndHandler&&i.on("keyup",this._ctrlEndHandler),this._moveHandler=h,!c){const e=function(){t.setEChartsLayerVisibility(!1),setTimeout((function(){t.setEChartsLayerVisibility(!0)}),500)};this._moveStartHandler=e,i.on("move",e),i.on("zoomstart",e),i.on("zoom",e)}if(d){let t=function(){(0,e.getInstanceByDom)(o.getDom()).resize()};f&&(t=(0,e.throttle)(t,20,!0)),this._resizeHandler=t,i.on("resize",t)}this._isFirstRender=r=!1},dispose(){n={};const e=this.__model;e&&(e.getLeaflet()&&(e.getLeaflet().off(),e.getLeaflet().remove()),e.setLeaflet(null),e.setEChartsLayer(null),e.coordinateSystem&&(e.coordinateSystem.setLeaflet(null),e.coordinateSystem=null),delete this._moveHandler,delete this._resizeHandler,delete this._moveStartHandler,delete this._moveEndHandler,delete this._ctrlEndHandler,delete this._ctrlStartHandler)}},u=e.ComponentView.extend(p);(0,e.use)((function(e){5==t[0]&&t[1]<4&&e.registerLayout((function(e,t){e.eachSeriesByType("pie",(function(e){const t=e.coordinateSystem,n=e.getData(),o=n.mapDimension("value");if(t&&"lmap"===t.type){const r=e.get("center"),i=t.dataToPoint(r),a=i[0],s=i[1];n.each(o,(function(e,t){const o=n.getItemLayout(t);o.cx=a,o.cy=s}))}}))})),e.registerComponentModel(m),e.registerComponentView(u),e.registerCoordinateSystem("lmap",f),e.registerAction({type:"lmapRoam",event:"lmapRoam",update:"updateLayout"},(function(e,t){t.eachComponent("lmap",(function(e){const t=e.getLeaflet(),n=t.getCenter();e.setCenterAndZoom([n.lat,n.lng],t.getZoom())}))}))}))})(),i})()));